var getURLQuery=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),c=t.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},API=function(){var e="http://127.0.0.1:8888",t="http://api.vgee.cn",c="true"==getURLQuery("debug")?e:t;return{get:c+"/msg",post:c+"/msg",del:c+"/msg",policy:c+"/policy"}}(),checkPageMode=function(){"true"==getURLQuery("del")&&($('input[type="checkbox"]').show(),$(".go-del").show().click(function(){deleteMessages()}))},deleteMessages=function(){var e=function(){var e=[];return $('input[type="checkbox"]').each(function(t,c){1==c.checked&&e.push(c.value)}),console.log(e),e},t=function(){$.ajax({url:API.del,type:"DELETE",data:{ids:e().join(",")}}).success(function(e){return 1!=e.flag?void alert("delete fail"):void window.location.reload()})};t()},icons={"01":"&#xe604;","02":"&#xe603;","03":"&#xe606;","04":"&#xe601;","09":"&#xe600;",10:"&#xe607;",11:"&#xe602;",13:"&#xe608;",50:"&#xe605;"},getData=function(){var e=[];$.getJSON(API.get).success(function(t){return 1!=t.flag?void alert("服务器发生了一个错误，请联系贝爷"):(t=t.data,$.each(t,function(t,c){c.first&&(c.message=c.first+"\n\n"+c.sec),c.city||(c.city="未知"),c.weither||(c.weither="未知");var i=function(e){return e=10>e?"0"+e:e},n=new Date(c.createdAt);n=n.getMonth()+1+"/"+n.getDate()+" "+i(n.getHours())+":"+i(n.getMinutes());var a=icons[c.weither_icon]||"&#xe604;",s=c.img?"":"no-img",o=c.message.replace(/\/_rt\//g,"\n"),r=['<div class="container '+s+'">','<div class="pic-ct">','<img src="'+c.img+'" alt="">',"</div>",'<div class="text-ct">',"<pre>"+o+"</pre>",'<p class="user">-- <span>'+c.author+"</span></p>",'<div class="acts">','<div class="act">','<i class="iconfont">'+a+"</i>    ","<p>"+c.weither+"</p>","</div>",'<div class="act">','<i class="iconfont">&#xe60b;</i>',"<p>"+n+"</p>","</div>",'<div class="act">','<i class="iconfont location">&#xe60c;</i>',"<p>"+c.city+"</p>","</div>",'<input style="display:none" value="'+c._id+'" type="checkbox">',"</div>","</div>","</div>"];r=r.join("\n"),e.push(r)}),$(".big-ct").html(e.join("\n")),void checkPageMode())})};$(function(){getData()});