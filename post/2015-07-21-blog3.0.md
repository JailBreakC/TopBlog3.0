title:Blog 3.0
disc:第三版博客开发中、期待一下扁平化设计和绚丽的交互吧~
type:project
------------------

## 技术摘要

`AngularJS` 强力驱动。 

3.0版本重构全部代码！全新的交互体验，大幅优化网站加载速度！追求极致不妥协！

使用的框架和类库：

- 前端MVVM框架： `AngularJS`， 插件：`ng-animate`, `ng-route` <http://docs.angularjs.cn/api>
- 模块加载器 `requireJS`  <http://www.requirejs.cn/>
- UI框架：`BootStrap` 高效、响应式   <http://getskel.com/>
- 使用 `CoffeeScript` 编写简洁顺滑的js代码 <http://coffee-script.org/>
- 使用 `Less` 编写可嵌套、可编程的CSS代码 <http://lesscss.org/>
- 构建工具 `grunt` <http://www.gruntjs.net/>

** 3.0依旧采用无后端模式，使用angular自动路由，前端解析。 **

## 3.0测试版正式上线！

历时数月，第测试版终于和大家见面了。请使用chrome核心的浏览器访问~

3.0的核心是 `性能`、 `动画`、`主题`、`动态加载`、`响应式`。

在博客后面的更新中，我会逐个介绍的。

### 性能：

- AngularJS，使用AngularJS编写的单页应用，能够有效的提高页面切换效率，降低页面渲染时间减少网页请求，提供有趣的切页动画，以及在前端管理复杂的路由情况。
*TODO 单页应用对SEO支持较差， 可以使用 prerender 来解决。 
- 代码压缩，之前的两版博客在对前端性能上的考虑几乎没有，代码也是直接写好能运行就行。 这次改版首先对使用 `grunt` 对 js、css 进行压缩、合并处理，减小文件体积，减少http请求。
- 组件的加载，全部使用 `requireJS` 进行管理，比如只有在点击博客内容的时候，
才会加载渲染markdown(markdown.js) 和 语法高亮(highlight.js)的组件。
- 托管，原来的博客托管在sae上面，但是本站没有备案，在sae上绑定自己域名的时候只能走海外流量，所以导致打开速度极慢。现在使用的是gitcafe上的page服务，访问速度比以前有了巨大的飞跃
- CDN，目前视频和背景图片是分别放在七牛云储存上和阿里的CDN上。*TODO 静态资源全部部署CDN、加载图片大小根据屏幕大小自动调整
- 成果，现在博客打开的稳定性大幅提高，几乎不会出现无法访问的状况，加载速度提升5倍以上

### 动画：

- 首页背景视频，大片纯色蒙版，扁平化设计，简洁清爽，鼠标悬浮按钮上，会有抽屉效果弹出简介，按钮有水波纹动画。背景实际上是两个屏幕大的色块，
鼠标悬浮时有一半会叠加在一起，会有颜色加深效果。 背景视频在各种分辨率总是呈覆盖整屏状态，并且居中显示，用js模拟了CSS3的background-size:cover效果。
- 切页动画，利用视图切换时angular自动给正在切换的两个view加上的ng-leave 、 ng-enter类来实现这一效果。
- 顶部按钮动画，鼠标悬浮之后，文字会被分成两半，再由中间出来。文字分成两半的效果是由:before、:after这俩个伪类实现的
- CSS代码如下

```

	/*首先需要给html标签加上data-text属性，里面填上按钮里的文字.
	<a data-text="Blog" href="#/blog/all"><span>Blog</span></a>*/

	/*然后给该元素的:before, :after伪类定义一些样式，让他们分别盖住原来元素的上半部分和下半部分。*/
	a:before, a:after {
        content: attr(data-text);
        position: absolute;
        text-align: center;
        width: 100%;
        height: 50%;
        left: 0;
        background: transparent;
        color: #fff;
        overflow: hidden;
        transition: transform 0.3s;
        transition-timing-function: cubic-bezier(0.2, 1, 0.3, 1);
    }
    /*通过line-height: 0来将文字挤上去一半*/
    a:after {
        bottom: 0;
        line-height: 0;
    }
    /*通过padding-top: 1em 来将文字挤下去一半*/
    a:before {
        top: 0;
        padding-top: 1em;
    }
    /*里面的文字先缩小隐藏*/
    a>span {
        display: block;
        transform: scale3d(0.2, 0.2, 1);
        opacity: 0;
        transition: transform 0.3s, opacity 0.3s;
        transition-timing-function: cubic-bezier(0.2, 1, 0.3, 1);
    }
    /*鼠标悬浮时动画 伪类元素上下移走 里面文字弹出*/
    a:hover {
        color: white;
        span {
            opacity: 1;
            transform: scale3d(1, 1, 1)
        }
        &:before {
            transform: translate3d(0, -100%, 0);
        }
        &:after {
            transform: translate3d(0, 100%, 0);
        }
    }
```

- blog页动画
	+ 大屏幕文字悬浮时更换字体 TODO：准备使用webfont实现更多字体
	+ 大屏幕文字滚动时放大变虚
	+ 博客列表滚动时动态出现，落下效果，三个都是由指令实现。
	+ coffeeScript代码如下：

	#悬浮改变字体
    app.directive 'changeFont', ->
    restrict: 'A'
    link: (scope, element, attrs) ->
        fonts = [
            'cursive',
            '-webkit-body',
            '-webkit-pictograph',
            'fantasy',
            'serif'
        ]
        i = 0
        task = {}
        $(element).hover( ->
            that = @
            title = $('.navbar-brand');
            task.now = setInterval $.proxy( ->
                $(title).css('font-family',fonts[i]);
                $(that).css('font-family',fonts[i]);
                if ++i >= 5
                    i = 0
            ), 200
        , ->
            clearInterval(task.now)
        )

	#博客列表的动画，滚动时在下方出现
    app.directive 'celAnimate',['$rootScope', ($rootScope) ->
        restrict: 'EA'
        link: (scope,element,attrs) ->
            $(element).addClass('cel-hide')
            scrollCheck = 0
            animationCheck = ->
                if $(element).hasClass('cel-show') then return

                height = $(window).height()
                top = $(window).scrollTop()
                pos = $(element).offset().top
                if pos - top <= height
                    $(element).removeClass('cel-hide').addClass('cel-show')
                scrollCheck = 1
            #初始化首次检测
            animationCheck()
            #滚动式检测动画
            $(window).scroll ->
                scrollCheck = 0
                
            #页面切换时，检测动画
            $rootScope.$on('$routeChangeSuccess', ->
            	#加入到事件队列中
                setTimeout ->
                    animationCheck()
            )
            #节流，每200毫秒执行一次滚动动画检测
            setInterval( ->
                if scrollCheck == 0
                    animationCheck()
            , 200)
        ]

    #滚动时主标题文字变大变虚
    app.directive 'scrollFade', ->
        restrict: 'A'
        link: (scope, element, attrs) ->
            $ele = $(element)
            $window = $(window)
            eHeight = $ele.height()
            eTop = $ele.offset().top
            $window.scroll ->
                wTop = $window.scrollTop()
                if wTop > eTop && wTop - eTop <= eHeight * 2
                    size = (wTop - eTop) / (eHeight * 2) + 1
                    opacity = 1 - (wTop - eTop) / (eHeight * 2)
                    $ele.css({'transform': 'scale('+size+')', 'opacity': opacity})
- 主题中的动画
	+ 切换主题时，背景图片会有一个切换效果，原理是有两个












